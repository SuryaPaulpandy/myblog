{% extends 'blog/base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="row d-flex justify-content-center">
        <div class="col-md-4">
            <h2 class="text-center">Reset Password</h2>
            <div>
                {% include 'blog/includes/errors.html' %}
            </div>

            <!-- Countdown Timer Display -->
            {% if request.session.reset_password_active %}
                <div class="alert alert-warning text-center" role="alert">
                    This page will expire in <strong><span id="countdown">5:00</span></strong> minutes.
                </div>
            {% endif %}

            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="new_password" class="form-label">New Password</label>
                    <input type="password" class="form-control" id="new_password" name="new_password" required>
                </div>
                <div class="mb-3">
                    <label for="confirm_password" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                </div>
                <button type="submit" class="btn btn-primary">Change Password</button>
            </form>

            <div class="text-center mt-3">
                <a href="{% url 'blog:login' %}">Back to Login</a>
            </div>
        </div>
    </div>
</div>

<!-- Timer Script -->
{% if request.session.reset_password_active %}
<script>
    let seconds = 300;  // 5 minutes
    const countdownEl = document.getElementById("countdown");

    function updateCountdown() {
        const min = Math.floor(seconds / 60);
        let sec = seconds % 60;
        sec = sec < 10 ? "0" + sec : sec;
        countdownEl.textContent = `${min}:${sec}`;
        if (seconds > 0) {
            seconds--;
            setTimeout(updateCountdown, 1000);
        } else {
            alert("Session expired! Redirecting to Forgot Password...");
            window.location.href = "{% url 'blog:forgot_password' %}";
        }
    }

    updateCountdown();
</script>
{% endif %}
{% endblock %}
