{% extends 'blog/base.html' %}

{% block content %}
<div class="container py-5 animate__animated animate__fadeIn">
  <div class="row g-5">
    <!-- Main Content Column -->
    <div class="col-lg-8">
      <article class="blog-post">
        <div class="mb-4">
          <span
            class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2 mb-2">{{post.category.name|default:"General"}}</span>
          <h1 class="fw-bold display-5 mb-2">{{ post.title }}</h1>
          <div class="text-muted d-flex align-items-center gap-3 small">
            <span><i class="bi bi-calendar3 me-1"></i>{{ post.created_at|date:"F j, Y" }}</span>
            {% if post.user %}
            <span><i class="bi bi-person me-1"></i>{{ post.user.username }}</span>
            {% endif %}

            {% if user.is_authenticated %}
            <a href="{% url 'blog:toggle_save_post' post_id=post.id %}" class="text-decoration-none ms-auto"
              title="{% if request.user in post.saved_by.all %}Unsave Post{% else %}Save Post{% endif %}">
              {% if request.user in post.saved_by.all %}
              <i class="bi bi-bookmark-fill fs-5 text-primary"></i>
              {% else %}
              <i class="bi bi-bookmark fs-5 text-muted"></i>
              {% endif %}
            </a>
            {% endif %}
          </div>
        </div>

        <div class="mb-4 overflow-hidden rounded-4 shadow-sm">
          <img src="{{post.formatted_img_url}}" class="img-fluid w-100 object-fit-cover" alt="{{post.title}}"
            style="max-height: 500px;">
        </div>

        <div class="blog-content fs-5 lh-lg text-secondary">
          {{ post.content|linebreaks }}
        </div>

        <div class="mt-5 pt-4 border-top">
          <a href="{% url 'blog:index' %}" class="btn btn-outline-primary rounded-pill icon-link icon-link-hover">
            <i class="bi bi-arrow-left"></i> Back to Home
          </a>
        </div>
      </article>
    </div>

    <!-- Sidebar Column -->
    <div class="col-lg-4">
      <div class="position-sticky" style="top: 100px;">
        <div class="card border-0 shadow-sm rounded-4 mb-4">
          <div class="card-body p-4">
            <h4 class="card-title fw-bold mb-4">Related Posts</h4>

            {% if related_posts %}
            <div class="d-flex flex-column gap-3">
              {% for related_post in related_posts %}
              <div
                class="d-flex align-items-center gap-3 group-hover-bg p-2 rounded-3 transition-all position-relative">
                <img src="{{related_post.formatted_img_url}}" class="rounded-3 object-fit-cover" width="80" height="80"
                  alt="{{related_post.title}}">
                <div>
                  <h6 class="mb-1 fw-bold">
                    <a href="{% url 'blog:detail' slug=related_post.slug %}"
                      class="text-decoration-none text-dark stretched-link">
                      {{ related_post.title|truncatechars:40 }}
                    </a>
                  </h6>
                  <small class="text-muted">{{ related_post.created_at|date:"M d" }}</small>
                </div>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <div class="text-center text-muted py-4">
              <i class="bi bi-journal-x fs-1 mb-2 d-block"></i>
              No related posts found.
            </div>
            {% endif %}
          </div>
        </div>

        <div class="card border-0 bg-primary-subtle rounded-4 p-4 text-center">
          <h5 class="fw-bold text-primary mb-2">Subscribe to our Newsletter</h5>
          <p class="small text-muted mb-3">Get the latest posts delivered right to your inbox.</p>
          <form action="{% url 'blog:subscribe' %}" method="post">
            {% csrf_token %}
            <div class="mb-2">
              <input type="email" name="email" class="form-control rounded-pill" placeholder="Enter your email"
                required>
            </div>
            <button type="submit" class="btn btn-primary w-100 rounded-pill shadow-sm">Subscribe Now</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .blog-content p {
    margin-bottom: 1.5rem;
  }

  .object-fit-cover {
    object-fit: cover;
  }

  .transition-all {
    transition: all 0.2s ease;
  }

  .group-hover-bg:hover {
    background-color: var(--bs-gray-100);
  }
</style>
{% endblock %}