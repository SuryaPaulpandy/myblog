{% extends 'blog/base.html' %}

{% block meta_description %}Discover the latest stories, thinking, and expertise from writers on any topic on our
awesome blog.{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="py-5 text-center container">
    <div class="row py-lg-5 animate__animated animate__fadeInDown">
        <div class="col-lg-6 col-md-8 mx-auto">
            <h1 class="fw-bold display-4 text-gradient mb-3">{{blog_title|default:"My Awesome Blog"}}</h1>
            <p class="lead text-muted">Discover stories, thinking, and expertise from writers on any topic. Subscribe to
                the newsletter to get latest updates.</p>
            <p>
                {% if not user.is_authenticated %}
                <a href="{% url 'blog:register' %}" class="btn btn-primary-custom my-2 shadow-sm">Get Started</a>
                <a href="{% url 'blog:login' %}" class="btn btn-outline-custom my-2">Sign In</a>
                {% else %}
                <a href="{% url 'blog:dashboard' %}" class="btn btn-primary-custom my-2 shadow-sm">Go to Dashboard</a>
                {% endif %}
            </p>
        </div>
    </div>
</section>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
        <h3 class="fw-bold m-0"><i class="bi bi-newspaper me-2 text-secondary"></i>Latest Posts</h3>
        <div class="dropdown">
            <button class="btn btn-light dropdown-toggle rounded-pill px-3 border shadow-sm" type="button"
                id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                {{ current_category|default:"All Categories" }}
            </button>
            <ul class="dropdown-menu border-0 shadow" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="{% url 'blog:index' %}">All Categories</a></li>
                {% for category in categories %}
                <li><a class="dropdown-item" href="?category={{ category.name }}">{{ category.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>

    {% include "blog/includes/errors.html" %}

    {% if page_obj %}
    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for post in page_obj %}
        <div class="col">
            <div class="card h-100 card-hover border-0 rounded-4 overflow-hidden shadow-sm">
                <div class="position-relative overflow-hidden">
                    <img src="{{post.formatted_img_url}}" class="card-img-top zoom-effect" alt="{{post.title}}"
                        style="height: 220px; object-fit: cover;">
                    <span
                        class="position-absolute top-0 end-0 bg-white badge text-dark m-3 rounded-pill shadow-sm py-2 px-3 fw-bold">
                        {{post.category.name|default:"General"}}
                    </span>
                </div>
                <div class="card-body d-flex flex-column p-4">
                    <h5 class="card-title fw-bold mb-3">{{ post.title }}</h5>
                    <p class="card-text text-muted flex-grow-1" style="font-size: 0.95rem;">
                        {{ post.content|truncatechars:100 }}
                    </p>
                    <div class="mt-4 pt-3 border-top d-flex justify-content-between align-items-center">
                        <a href="{% url 'blog:detail' slug=post.slug %}"
                            class="text-primary fw-bold text-decoration-none">Read Article <i
                                class="bi bi-arrow-right ms-1"></i></a>
                        <small class="text-muted">{{post.category.name}}</small>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="mt-5 d-flex justify-content-center">
        {% if page_obj.has_other_pages %}
        <nav aria-label="Page navigation">
            <ul class="pagination pagination-lg align-items-center g-2">
                {% if page_obj.has_previous %}
                <li class="page-item me-1">
                    <a class="page-link border-0 shadow-sm rounded-circle d-flex align-items-center justify-content-center"
                        style="width: 45px; height: 45px; color: #2d3748; background-color: #fff;"
                        href="?page={{ page_obj.previous_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}"
                        aria-label="Previous">
                        <i class="bi bi-chevron-left" style="font-size: 1rem;"></i>
                    </a>
                </li>
                {% endif %}

                {% for i in custom_range %}
                {% if page_obj.number == i %}
                <li class="page-item active mx-1" aria-current="page">
                    <span
                        class="page-link border-0 shadow rounded-circle d-flex align-items-center justify-content-center bg-primary text-white fw-bold"
                        style="width: 45px; height: 45px; font-size: 1.1rem;">{{ i }}</span>
                </li>
                {% elif i == paginator.ELLIPSIS %}
                <li class="page-item disabled mx-1">
                    <span
                        class="page-link border-0 bg-transparent text-muted d-flex align-items-center justify-content-center"
                        style="width: 45px; height: 45px; font-size: 1.2rem;">...</span>
                </li>
                {% else %}
                <li class="page-item mx-1">
                    <a class="page-link border-0 shadow-sm rounded-circle d-flex align-items-center justify-content-center text-dark bg-white hover-up"
                        style="width: 45px; height: 45px; font-weight: 500;"
                        href="?page={{ i }}{% if current_category %}&category={{ current_category }}{% endif %}">
                        {{ i }}
                    </a>
                </li>
                {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <li class="page-item ms-1">
                    <a class="page-link border-0 shadow-sm rounded-circle d-flex align-items-center justify-content-center"
                        style="width: 45px; height: 45px; color: #2d3748; background-color: #fff;"
                        href="?page={{ page_obj.next_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}"
                        aria-label="Next">
                        <i class="bi bi-chevron-right" style="font-size: 1rem;"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>

    {% else %}
    <div class="text-center py-5 my-5">
        <div class="mb-3">
            <i class="bi bi-emoji-frown fs-1 text-muted"></i>
        </div>
        <h4 class="text-muted">No posts found to display.</h4>
    </div>
    {% endif %}
</div>
{% endblock %}